<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive 365-Day Test - iLearn 2025</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #00ff00;
            line-height: 1.4;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: #000;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 8px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border: 1px solid #00ff00;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: #00ff00;
            transition: width 0.3s ease;
        }
        .log-container {
            background: #111;
            border: 1px solid #00ff00;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-success { color: #00ff00; }
        .log-error { color: #ff0000; }
        .log-warning { color: #ffff00; }
        .log-info { color: #00ffff; }
        .log-progress { color: #ff00ff; }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .result-card {
            background: #111;
            border: 1px solid #00ff00;
            padding: 15px;
            border-radius: 5px;
        }
        .result-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #00ff00;
        }
        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffff00;
        }
        .result-description {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .control-btn {
            background: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .control-btn:hover {
            background: #00ff00;
            color: #000;
        }
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .month-breakdown {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .month-card {
            background: #111;
            border: 1px solid #00ff00;
            padding: 10px;
            text-align: center;
            font-size: 12px;
        }
        .month-name {
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }
        .month-stats {
            color: #ccc;
        }
        
        .export-section {
            margin: 20px 0;
            padding: 15px;
            background: #111;
            border: 1px solid #00ff00;
        }
        .export-btn {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>üéØ COMPREHENSIVE 365-DAY TEST</h1>
            <h2>iLearn 2025 - Complete Calendar Functionality</h2>
            <p>Testing every single day for tooltips and lesson loading</p>
        </div>

        <div class="controls">
            <button class="control-btn" id="start-test">üöÄ START COMPREHENSIVE TEST</button>
            <button class="control-btn" id="stop-test" disabled>‚èπÔ∏è STOP TEST</button>
            <button class="control-btn" id="export-results" disabled>üì§ EXPORT RESULTS</button>
            <button class="control-btn" id="clear-log">üóëÔ∏è CLEAR LOG</button>
        </div>

        <div class="progress-section">
            <h3>üìä Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text">Ready to start...</div>
        </div>

        <div class="results-grid">
            <div class="result-card">
                <div class="result-title">Total Days Tested</div>
                <div class="result-value" id="total-days">0</div>
                <div class="result-description">All 365 days of 2025</div>
            </div>
            <div class="result-card">
                <div class="result-title">Days with Lessons</div>
                <div class="result-value" id="days-with-lessons">0</div>
                <div class="result-description">Days that have lesson data</div>
            </div>
            <div class="result-card">
                <div class="result-title">Days with Tooltips</div>
                <div class="result-value" id="days-with-tooltips">0</div>
                <div class="result-description">Days with working tooltips</div>
            </div>
            <div class="result-card">
                <div class="result-title">Success Rate</div>
                <div class="result-value" id="success-rate">0%</div>
                <div class="result-description">Overall test success rate</div>
            </div>
            <div class="result-card">
                <div class="result-title">Lesson Coverage</div>
                <div class="result-value" id="lesson-coverage">0%</div>
                <div class="result-description">Percentage of days with lessons</div>
            </div>
            <div class="result-card">
                <div class="result-title">Tooltip Coverage</div>
                <div class="result-value" id="tooltip-coverage">0%</div>
                <div class="result-description">Percentage of days with tooltips</div>
            </div>
        </div>

        <div class="month-breakdown" id="month-breakdown">
            <!-- Monthly breakdown will be populated here -->
        </div>

        <div class="log-section">
            <h3>üìù Test Log</h3>
            <div class="log-container" id="log-container">
                <div class="log-entry log-info">üöÄ Comprehensive test ready to start...</div>
                <div class="log-entry log-info">üìÖ Testing all 365 days of 2025</div>
                <div class="log-entry log-info">üîç Verifying tooltips and lesson loading</div>
            </div>
        </div>

        <div class="export-section">
            <h3>üì§ Export Results</h3>
            <button class="export-btn" onclick="exportToJSON()">Export as JSON</button>
            <button class="export-btn" onclick="exportToCSV()">Export as CSV</button>
            <button class="export-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
        </div>
    </div>

    <script src="complete-lesson-generator.js"></script>
    <script src="complete-lesson-player.js"></script>
    <script src="test-all-days.js"></script>
    <script>
        let testRunning = false;
        let testResults = null;
        let logContainer = null;

        document.addEventListener('DOMContentLoaded', () => {
            logContainer = document.getElementById('log-container');
            
            // Setup control buttons
            document.getElementById('start-test').addEventListener('click', startComprehensiveTest);
            document.getElementById('stop-test').addEventListener('click', stopTest);
            document.getElementById('export-results').addEventListener('click', showExportOptions);
            document.getElementById('clear-log').addEventListener('click', clearLog);
            
            // Override console.log to capture test output
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                addLogEntry(args.join(' '), 'info');
            };
            
            // Override console.error
            const originalError = console.error;
            console.error = function(...args) {
                originalError.apply(console, args);
                addLogEntry(args.join(' '), 'error');
            };
        });

        function addLogEntry(message, type = 'info') {
            if (!logContainer) return;
            
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateProgress(current, total) {
            const percentage = (current / total) * 100;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `Progress: ${current}/${total} days (${percentage.toFixed(1)}%)`;
        }

        function updateResults(results) {
            if (!results) return;
            
            document.getElementById('total-days').textContent = results.totalDays || 0;
            document.getElementById('days-with-lessons').textContent = results.daysWithLessons || 0;
            document.getElementById('days-with-tooltips').textContent = results.daysWithTooltips || 0;
            
            const successRate = results.totalDays ? ((results.successfulTests?.length || 0) / results.totalDays * 100).toFixed(1) : 0;
            const lessonCoverage = results.totalDays ? ((results.daysWithLessons || 0) / results.totalDays * 100).toFixed(1) : 0;
            const tooltipCoverage = results.totalDays ? ((results.daysWithTooltips || 0) / results.totalDays * 100).toFixed(1) : 0;
            
            document.getElementById('success-rate').textContent = `${successRate}%`;
            document.getElementById('lesson-coverage').textContent = `${lessonCoverage}%`;
            document.getElementById('tooltip-coverage').textContent = `${tooltipCoverage}%`;
        }

        function updateMonthBreakdown(results) {
            if (!results || !results.successfulTests) return;
            
            const monthBreakdown = document.getElementById('month-breakdown');
            monthBreakdown.innerHTML = '';
            
            for (let month = 1; month <= 12; month++) {
                const monthName = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][month - 1];
                const monthTests = results.successfulTests.filter(test => test.month === month);
                const monthLessons = monthTests.filter(test => test.hasLesson).length;
                const monthTooltips = monthTests.filter(test => test.hasTooltip).length;
                const daysInMonth = new Date(2025, month, 0).getDate();
                
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.innerHTML = `
                    <div class="month-name">${monthName}</div>
                    <div class="month-stats">
                        ${monthLessons}/${daysInMonth} lessons<br>
                        ${monthTooltips}/${daysInMonth} tooltips
                    </div>
                `;
                monthBreakdown.appendChild(monthCard);
            }
        }

        async function startComprehensiveTest() {
            if (testRunning) return;
            
            testRunning = true;
            document.getElementById('start-test').disabled = true;
            document.getElementById('stop-test').disabled = false;
            document.getElementById('export-results').disabled = true;
            
            addLogEntry('üöÄ Starting comprehensive 365-day test...', 'progress');
            
            try {
                // Wait for lesson player to be ready
                await waitForLessonPlayer();
                
                // Run the comprehensive test
                const results = await runComprehensiveTest();
                
                // Update UI with results
                updateResults(results);
                updateMonthBreakdown(results);
                
                testResults = results;
                document.getElementById('export-results').disabled = false;
                
                addLogEntry('üéâ Comprehensive test completed successfully!', 'success');
                
            } catch (error) {
                addLogEntry(`‚ùå Test failed: ${error.message}`, 'error');
            } finally {
                testRunning = false;
                document.getElementById('start-test').disabled = false;
                document.getElementById('stop-test').disabled = true;
            }
        }

        function stopTest() {
            testRunning = false;
            document.getElementById('start-test').disabled = false;
            document.getElementById('stop-test').disabled = true;
            addLogEntry('‚èπÔ∏è Test stopped by user', 'warning');
        }

        function clearLog() {
            if (logContainer) {
                logContainer.innerHTML = '';
                addLogEntry('üóëÔ∏è Log cleared', 'info');
            }
        }

        function showExportOptions() {
            addLogEntry('üì§ Export options available', 'info');
        }

        function exportToJSON() {
            if (!testResults) return;
            
            const dataStr = JSON.stringify(testResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'comprehensive-test-results.json';
            link.click();
            
            addLogEntry('üì§ Results exported as JSON', 'success');
        }

        function exportToCSV() {
            if (!testResults) return;
            
            let csv = 'Month,Day,HasLesson,HasTooltip,LessonTitle\n';
            
            testResults.successfulTests.forEach(test => {
                csv += `${test.month},${test.day},${test.hasLesson},${test.hasTooltip},"${test.lessonTitle || ''}"\n`;
            });
            
            const dataBlob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'comprehensive-test-results.csv';
            link.click();
            
            addLogEntry('üì§ Results exported as CSV', 'success');
        }

        function copyToClipboard() {
            if (!testResults) return;
            
            const summary = `
Comprehensive Test Results - iLearn 2025
======================================
Total Days: ${testResults.totalDays}
Days with Lessons: ${testResults.daysWithLessons}
Days with Tooltips: ${testResults.daysWithTooltips}
Success Rate: ${((testResults.successfulTests.length / testResults.totalDays) * 100).toFixed(1)}%
Lesson Coverage: ${((testResults.daysWithLessons / testResults.totalDays) * 100).toFixed(1)}%
Tooltip Coverage: ${((testResults.daysWithTooltips / testResults.totalDays) * 100).toFixed(1)}%
            `.trim();
            
            navigator.clipboard.writeText(summary).then(() => {
                addLogEntry('üìã Results copied to clipboard', 'success');
            });
        }

        async function waitForLessonPlayer() {
            return new Promise((resolve) => {
                const checkPlayer = () => {
                    if (window.lessonPlayer && window.lessonPlayer.fullYearData) {
                        addLogEntry('‚úÖ Lesson player ready', 'success');
                        resolve();
                    } else {
                        addLogEntry('‚è≥ Waiting for lesson player...', 'info');
                        setTimeout(checkPlayer, 500);
                    }
                };
                checkPlayer();
            });
        }

        async function runComprehensiveTest() {
            const results = {
                totalDays: 0,
                daysWithLessons: 0,
                daysWithoutLessons: 0,
                daysWithTooltips: 0,
                daysWithoutTooltips: 0,
                successfulTests: [],
                failedTests: []
            };

            // Test all 365 days
            for (let month = 1; month <= 12; month++) {
                const daysInMonth = new Date(2025, month, 0).getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    if (!testRunning) break;
                    
                    results.totalDays++;
                    
                    try {
                        const lessonData = window.lessonPlayer.getLessonData(month, day);
                        
                        const testResult = {
                            month,
                            day,
                            success: true,
                            hasLesson: false,
                            hasTooltip: false,
                            lessonTitle: null,
                            tooltipContent: null
                        };
                        
                        if (lessonData) {
                            testResult.hasLesson = true;
                            testResult.lessonTitle = lessonData.title;
                            results.daysWithLessons++;
                            
                            const tooltip = `${lessonData.title}\n\n${lessonData.learning_objective}`;
                            if (tooltip && tooltip.length > 0) {
                                testResult.hasTooltip = true;
                                testResult.tooltipContent = tooltip;
                                results.daysWithTooltips++;
                            } else {
                                results.daysWithoutTooltips++;
                            }
                        } else {
                            results.daysWithoutLessons++;
                        }
                        
                        results.successfulTests.push(testResult);
                        
                    } catch (error) {
                        results.failedTests.push({
                            month,
                            day,
                            success: false,
                            error: error.message
                        });
                    }
                    
                    // Update progress every 10 days
                    if (results.totalDays % 10 === 0) {
                        updateProgress(results.totalDays, 365);
                        addLogEntry(`üìä Progress: ${results.totalDays}/365 days tested`, 'progress');
                    }
                }
            }

            addLogEntry(`üéØ Test completed: ${results.totalDays} days tested`, 'success');
            return results;
        }
    </script>
</body>
</html> 