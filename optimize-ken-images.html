<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ken Image Optimizer - Browser-Based</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .optimizer-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .optimizer-section h2 {
            color: #007AFF;
            margin-bottom: 16px;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .image-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .image-item img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .image-item h3 {
            font-size: 14px;
            margin-bottom: 4px;
            color: #333;
        }

        .image-item p {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .controls {
            margin-top: 16px;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 8px;
        }

        input[type="number"] {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 4px;
        }

        button:hover {
            background: #0056CC;
        }

        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
        }

        .download-link {
            display: inline-block;
            background: #28a745;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
        }

        .download-link:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ken Image Optimizer - Browser-Based</h1>
        
        <div class="optimizer-section">
            <h2>Image Optimization Controls</h2>
            
            <div class="control-group">
                <label for="quality-slider">WebP Quality: <span id="quality-value">85</span>%</label>
                <input type="range" id="quality-slider" min="50" max="95" value="85" step="5">
            </div>
            
            <div class="control-group">
                <label for="max-width">Max Width: <input type="number" id="max-width" value="1920" min="320" max="3840"></label>
            </div>
            
            <div class="control-group">
                <label for="max-height">Max Height: <input type="number" id="max-height" value="1080" min="180" max="2160"></label>
            </div>
            
            <button onclick="optimizeAllImages()">Optimize All Ken Images</button>
            <button onclick="downloadAllOptimized()">Download All Optimized</button>
        </div>

        <div class="optimizer-section">
            <h2>Original Images</h2>
            <div class="image-preview" id="original-images">
                <!-- Original images will be loaded here -->
            </div>
        </div>

        <div class="optimizer-section">
            <h2>Optimized Images</h2>
            <div class="image-preview" id="optimized-images">
                <!-- Optimized images will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Ken image paths
        const kenImages = [
            {
                name: 'ken_neutral_default',
                path: 'lesson-player-deploy/assets/avatars/ken/ken_neutral_default.png',
                originalSize: '1.2MB'
            },
            {
                name: 'ken_happy_celebrating',
                path: 'lesson-player-deploy/assets/avatars/ken/emotional-expressions/ken_happy_celebrating.png',
                originalSize: '1.1MB'
            },
            {
                name: 'ken_concerned_thinking',
                path: 'lesson-player-deploy/assets/avatars/ken/emotional-expressions/ken_concerned_thinking.png',
                originalSize: '1.3MB'
            },
            {
                name: 'ken_question_curious',
                path: 'lesson-player-deploy/assets/avatars/ken/lesson-sequence/ken_question_curious.png',
                originalSize: '1.2MB'
            },
            {
                name: 'ken_teaching_explaining',
                path: 'lesson-player-deploy/assets/avatars/ken/lesson-sequence/ken_teaching_explaining.png',
                originalSize: '1.3MB'
            }
        ];

        // Store optimized images
        const optimizedImages = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadOriginalImages();
            updateQualityDisplay();
        });

        // Update quality display
        function updateQualityDisplay() {
            const quality = document.getElementById('quality-slider').value;
            document.getElementById('quality-value').textContent = quality;
        }

        // Load original images
        function loadOriginalImages() {
            const container = document.getElementById('original-images');
            
            kenImages.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${image.path}" alt="${image.name}" 
                         onload="this.parentElement.querySelector('p').textContent = 'Loaded successfully'"
                         onerror="this.parentElement.querySelector('p').textContent = 'Failed to load'">
                    <h3>${image.name}.png</h3>
                    <p class="status loading">Loading...</p>
                    <p>Original: ${image.originalSize}</p>
                `;
                container.appendChild(imageItem);
            });
        }

        // Optimize image using Canvas API
        function optimizeImage(imagePath, quality, maxWidth, maxHeight) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions
                    const ratio = Math.min(maxWidth / img.width, maxHeight / img.height);
                    const newWidth = img.width * ratio;
                    const newHeight = img.height * ratio;
                    
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    
                    // Draw resized image
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                    
                    // Convert to WebP
                    canvas.toBlob(resolve, 'image/webp', quality / 100);
                };
                
                img.src = imagePath;
            });
        }

        // Optimize all images
        async function optimizeAllImages() {
            const quality = document.getElementById('quality-slider').value;
            const maxWidth = parseInt(document.getElementById('max-width').value);
            const maxHeight = parseInt(document.getElementById('max-height').value);
            
            const container = document.getElementById('optimized-images');
            container.innerHTML = '<p class="status loading">Optimizing images...</p>';
            
            optimizedImages.length = 0; // Clear previous results
            
            for (const image of kenImages) {
                try {
                    const optimizedBlob = await optimizeImage(image.path, quality, maxWidth, maxHeight);
                    const optimizedUrl = URL.createObjectURL(optimizedBlob);
                    
                    // Calculate size
                    const sizeKB = Math.round(optimizedBlob.size / 1024);
                    const sizeMB = (sizeKB / 1024).toFixed(2);
                    
                    optimizedImages.push({
                        name: image.name,
                        blob: optimizedBlob,
                        url: optimizedUrl,
                        size: sizeKB
                    });
                    
                    // Create preview
                    const imageItem = document.createElement('div');
                    imageItem.className = 'image-item';
                    imageItem.innerHTML = `
                        <img src="${optimizedUrl}" alt="${image.name} optimized">
                        <h3>${image.name}.webp</h3>
                        <p class="status success">Optimized: ${sizeKB}KB (${sizeMB}MB)</p>
                        <a href="${optimizedUrl}" download="${image.name}_optimized.webp" class="download-link">Download</a>
                    `;
                    container.appendChild(imageItem);
                    
                } catch (error) {
                    console.error(`Error optimizing ${image.name}:`, error);
                    const errorItem = document.createElement('div');
                    errorItem.className = 'image-item';
                    errorItem.innerHTML = `
                        <h3>${image.name}</h3>
                        <p class="status error">Failed to optimize</p>
                    `;
                    container.appendChild(errorItem);
                }
            }
            
            // Show summary
            const totalSize = optimizedImages.reduce((sum, img) => sum + img.size, 0);
            const totalMB = (totalSize / 1024).toFixed(2);
            container.innerHTML += `
                <div style="grid-column: 1 / -1; margin-top: 20px; padding: 16px; background: #d4edda; border-radius: 8px;">
                    <h3>Optimization Complete!</h3>
                    <p>Total optimized size: ${totalSize}KB (${totalMB}MB)</p>
                    <p>Average per image: ${Math.round(totalSize / optimizedImages.length)}KB</p>
                </div>
            `;
        }

        // Download all optimized images
        function downloadAllOptimized() {
            if (optimizedImages.length === 0) {
                alert('Please optimize images first!');
                return;
            }
            
            optimizedImages.forEach((image, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = image.url;
                    link.download = `${image.name}_optimized.webp`;
                    link.click();
                }, index * 100); // Stagger downloads
            });
        }

        // Update quality display when slider changes
        document.getElementById('quality-slider').addEventListener('input', updateQualityDisplay);
    </script>
</body>
</html> 