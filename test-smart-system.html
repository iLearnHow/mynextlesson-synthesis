<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Lesson System Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        .control-group {
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .tone-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .tone-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tone-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .tone-btn.selected {
            background: rgba(255,255,255,0.3);
            border-color: white;
        }
        .lesson-content {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .lesson-section {
            margin-bottom: 20px;
        }
        .lesson-section h3 {
            margin-top: 0;
            color: #ffd700;
        }
        .performance {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
        }
        .success { color: #51cf66; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd700; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #5a6fd8;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧠 Smart Lesson System Test</h1>
        <p>Testing instant lesson serving with pre-generated variants</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="age-select">Age Group:</label>
                <select id="age-select">
                    <option value="early_childhood">Early Childhood (5-11)</option>
                    <option value="youth">Youth (12-17)</option>
                    <option value="young_adult">Young Adult (18+)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Tone Style:</label>
                <div class="tone-buttons">
                    <button class="tone-btn selected" data-tone="grandmother">👵 Grandmother</button>
                    <button class="tone-btn" data-tone="fun">🎉 Fun</button>
                </div>
            </div>
            
            <div class="control-group">
                <label for="day-select">Lesson Day:</label>
                <select id="day-select">
                    <option value="1">Day 1 - The Sun</option>
                </select>
            </div>
        </div>
        
        <button id="load-btn">🚀 Load Lesson</button>
        <button id="test-performance-btn">⚡ Test Performance</button>
        
        <div id="performance" class="performance" style="display: none;">
            <h3>Performance Metrics:</h3>
            <div id="performance-data"></div>
        </div>
        
        <div id="lesson-content" class="lesson-content" style="display: none;">
            <h2 id="lesson-title"></h2>
            
            <div class="lesson-section">
                <h3>Introduction</h3>
                <p id="introduction"></p>
            </div>
            
            <div class="lesson-section">
                <h3>Core Concept</h3>
                <p id="core-concept"></p>
            </div>
            
            <div class="lesson-section">
                <h3>Real-World Examples</h3>
                <p id="examples"></p>
            </div>
            
            <div class="lesson-section">
                <h3>Reflection Question</h3>
                <p id="reflection"></p>
            </div>
        </div>
    </div>

    <script>
        // Smart Lesson Server (simplified for testing)
        class SmartLessonServer {
            constructor() {
                this.variants = {
                    'day1_early_childhood_grandmother': {
                        content: "Oh my dear one, let me tell you something wonderful about our bright friend in the sky. The sun is like a magical friend that helps everything grow and gives us warm light every day. Think about feeling the warm sunshine on your face and watching flowers turn toward the sun. What do you see when you look at the sun?",
                        metadata: {
                            age_group: 'early_childhood',
                            tone_style: 'grandmother',
                            vocabulary: ['sun', 'warm', 'bright', 'light'],
                            complexity: 'concrete_observable_actions_and_immediate_effects'
                        }
                    },
                    'day1_early_childhood_fun': {
                        content: "Ready to have your mind BLOWN by the most incredible cosmic show! The sun is like a giant space light bulb that helps everything grow and gives us warm light every day. Think about feeling the warm sunshine on your face and watching flowers turn toward the sun. What do you see when you look at the sun?",
                        metadata: {
                            age_group: 'early_childhood', 
                            tone_style: 'fun',
                            vocabulary: ['sun', 'warm', 'bright', 'light'],
                            complexity: 'concrete_observable_actions_and_immediate_effects'
                        }
                    },
                    'day1_youth_grandmother': {
                        content: "Sweetheart, today we'll discover how the sun powers our world through fusion. The sun is a star that provides light and heat to Earth through nuclear fusion. Solar panels on calculators and photosynthesis powering food chains show us how the sun's energy works. How would Earth be different without the sun?",
                        metadata: {
                            age_group: 'youth',
                            tone_style: 'grandmother',
                            vocabulary: ['fusion', 'hydrogen', 'helium', 'radiation'],
                            complexity: 'systems_thinking_with_practical_applications'
                        }
                    },
                    'day1_youth_fun': {
                        content: "Welcome to the most incredible cosmic show! Let's explore fusion power! The sun is a star that provides light and heat to Earth through nuclear fusion. Solar panels on calculators and photosynthesis powering food chains show us how the sun's energy works. How would Earth be different without the sun?",
                        metadata: {
                            age_group: 'youth',
                            tone_style: 'fun', 
                            vocabulary: ['fusion', 'hydrogen', 'helium', 'radiation'],
                            complexity: 'systems_thinking_with_practical_applications'
                        }
                    },
                    'day1_young_adult_grandmother': {
                        content: "Let me share something that will amaze you about stellar nucleosynthesis. The sun is a main-sequence star converting hydrogen to helium through the proton-proton chain. Grid-scale solar installations and fusion research for clean energy show us the practical applications. How does understanding the sun help us understand other stars?",
                        metadata: {
                            age_group: 'young_adult',
                            tone_style: 'grandmother',
                            vocabulary: ['proton-proton_chain', 'stellar_nucleosynthesis', 'photovoltaic_efficiency'],
                            complexity: 'mechanistic_understanding_with_career_and_technology_applications'
                        }
                    },
                    'day1_young_adult_fun': {
                        content: "BOOM! Science magic happening! Let's dive into proton-proton chains! The sun is a main-sequence star converting hydrogen to helium through the proton-proton chain. Grid-scale solar installations and fusion research for clean energy show us the practical applications. How does understanding the sun help us understand other stars?",
                        metadata: {
                            age_group: 'young_adult',
                            tone_style: 'fun',
                            vocabulary: ['proton-proton_chain', 'stellar_nucleosynthesis', 'photovoltaic_efficiency'], 
                            complexity: 'mechanistic_understanding_with_career_and_technology_applications'
                        }
                    }
                };
            }

            async serveLesson(day, age, tone) {
                const startTime = performance.now();
                
                const variantKey = `day${day}_${age}_${tone}`;
                const variant = this.variants[variantKey];
                
                if (!variant) {
                    throw new Error(`Variant not found: ${variantKey}`);
                }

                const sections = this.splitContentIntoSections(variant.content);
                const lesson = {
                    day,
                    age,
                    tone,
                    title: this.generateTitle(day, age, tone),
                    sections: {
                        introduction: sections.introduction || this.generateFallbackSection('introduction', age, tone),
                        core_concept: sections.core_concept || this.generateFallbackSection('core_concept', age, tone),
                        examples: sections.examples || this.generateFallbackSection('examples', age, tone),
                        reflection: sections.reflection || this.generateFallbackSection('reflection', age, tone)
                    },
                    metadata: {
                        ...variant.metadata,
                        assembled: new Date().toISOString()
                    }
                };
                
                const responseTime = performance.now() - startTime;
                return { ...lesson, responseTime };
            }

            splitContentIntoSections(content) {
                const sections = {};
                const lines = content.split('. ');
                
                if (lines.length >= 4) {
                    sections.introduction = lines[0] + '.';
                    sections.core_concept = lines[1] + '.';
                    sections.examples = lines[2] + '.';
                    sections.reflection = lines[3] + '.';
                }
                
                return sections;
            }

            generateTitle(day, age, tone) {
                const ageTitles = {
                    early_childhood: "The Amazing Sun That Lights Up Our World",
                    youth: "The Sun - Earth's Incredible Energy Source", 
                    young_adult: "Solar Physics - Understanding Our Star"
                };
                
                const toneModifiers = {
                    grandmother: "Warm ",
                    fun: "Amazing ",
                    neutral: ""
                };
                
                return toneModifiers[tone] + ageTitles[age];
            }

            generateFallbackSection(sectionType, age, tone) {
                const fallbacks = {
                    introduction: {
                        early_childhood: "Let's learn about the bright sun in the sky!",
                        youth: "Today we'll discover how the sun powers our world.",
                        young_adult: "We'll examine the sun's role in stellar evolution and life."
                    },
                    core_concept: {
                        early_childhood: "The sun is like a giant light bulb in the sky that helps everything grow.",
                        youth: "The sun is a star that provides light and heat to Earth through fusion.",
                        young_adult: "The sun is a main-sequence star converting hydrogen to helium."
                    },
                    examples: {
                        early_childhood: "Think about feeling warm sunshine on your face and watching flowers grow.",
                        youth: "Solar panels on calculators and photosynthesis powering food chains.",
                        young_adult: "Grid-scale solar installations and fusion research for clean energy."
                    },
                    reflection: {
                        early_childhood: "What do you see when you look at the sun?",
                        youth: "How would Earth be different without the sun?",
                        young_adult: "How does understanding the sun help us understand other stars?"
                    }
                };
                
                return fallbacks[sectionType]?.[age] || "Content coming soon...";
            }
        }

        // Initialize
        const server = new SmartLessonServer();
        let currentAge = 'early_childhood';
        let currentTone = 'grandmother';
        let currentDay = 1;

        // DOM elements
        const ageSelect = document.getElementById('age-select');
        const toneButtons = document.querySelectorAll('.tone-btn');
        const daySelect = document.getElementById('day-select');
        const loadBtn = document.getElementById('load-btn');
        const testPerformanceBtn = document.getElementById('test-performance-btn');
        const performanceDiv = document.getElementById('performance');
        const performanceData = document.getElementById('performance-data');
        const lessonContent = document.getElementById('lesson-content');
        const lessonTitle = document.getElementById('lesson-title');
        const introduction = document.getElementById('introduction');
        const coreConcept = document.getElementById('core-concept');
        const examples = document.getElementById('examples');
        const reflection = document.getElementById('reflection');

        // Event listeners
        ageSelect.addEventListener('change', (e) => {
            currentAge = e.target.value;
        });

        toneButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                toneButtons.forEach(b => b.classList.remove('selected'));
                e.target.classList.add('selected');
                currentTone = e.target.dataset.tone;
            });
        });

        daySelect.addEventListener('change', (e) => {
            currentDay = parseInt(e.target.value);
        });

        loadBtn.addEventListener('click', loadLesson);
        testPerformanceBtn.addEventListener('click', testPerformance);

        async function loadLesson() {
            loadBtn.disabled = true;
            loadBtn.textContent = '🔄 Loading...';
            
            try {
                const startTime = performance.now();
                const lesson = await server.serveLesson(currentDay, currentAge, currentTone);
                const totalTime = performance.now() - startTime;
                
                // Update UI
                lessonTitle.textContent = lesson.title;
                introduction.textContent = lesson.sections.introduction;
                coreConcept.textContent = lesson.sections.core_concept;
                examples.textContent = lesson.sections.examples;
                reflection.textContent = lesson.sections.reflection;
                
                lessonContent.style.display = 'block';
                
                // Show performance
                performanceDiv.style.display = 'block';
                performanceData.innerHTML = `
                    <div class="success">✅ Lesson loaded in ${totalTime.toFixed(2)}ms</div>
                    <div>Age: ${currentAge}</div>
                    <div>Tone: ${currentTone}</div>
                    <div>Day: ${currentDay}</div>
                    <div>Vocabulary: ${lesson.metadata.vocabulary.join(', ')}</div>
                    <div>Complexity: ${lesson.metadata.complexity}</div>
                `;
                
            } catch (error) {
                console.error('Failed to load lesson:', error);
                performanceData.innerHTML = `<div class="error">❌ Failed to load lesson: ${error.message}</div>`;
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = '🚀 Load Lesson';
            }
        }

        async function testPerformance() {
            testPerformanceBtn.disabled = true;
            testPerformanceBtn.textContent = '⚡ Testing...';
            
            const results = [];
            const combinations = [
                { age: 'early_childhood', tone: 'grandmother' },
                { age: 'early_childhood', tone: 'fun' },
                { age: 'youth', tone: 'grandmother' },
                { age: 'youth', tone: 'fun' },
                { age: 'young_adult', tone: 'grandmother' },
                { age: 'young_adult', tone: 'fun' }
            ];
            
            for (const combo of combinations) {
                const startTime = performance.now();
                await server.serveLesson(1, combo.age, combo.tone);
                const time = performance.now() - startTime;
                results.push({ ...combo, time });
            }
            
            const avgTime = results.reduce((sum, r) => sum + r.time, 0) / results.length;
            const maxTime = Math.max(...results.map(r => r.time));
            const minTime = Math.min(...results.map(r => r.time));
            
            performanceDiv.style.display = 'block';
            performanceData.innerHTML = `
                <div class="success">⚡ Performance Test Results:</div>
                <div>Average: ${avgTime.toFixed(2)}ms</div>
                <div>Fastest: ${minTime.toFixed(2)}ms</div>
                <div>Slowest: ${maxTime.toFixed(2)}ms</div>
                <div class="warning">Target: <200ms ✅</div>
            `;
            
            testPerformanceBtn.disabled = false;
            testPerformanceBtn.textContent = '⚡ Test Performance';
        }

        // Auto-load first lesson
        window.addEventListener('load', () => {
            setTimeout(loadLesson, 1000);
        });
    </script>
</body>
</html> 