!function(){"use strict";var e,t,s={452:function(e,t,s){s.d(t,{$:function(){return i}});const i=new class{constructor(){this.config={claude:{apiKey:null,model:"claude-3-5-sonnet-20241022",maxTokens:2e3,timeout:3e4},synthesis:{cacheSize:1e3,performanceBudget:200,enableClaudeAPI:!0,fallbackToTemplates:!0},ui:{theme:"light",language:"english",accessibility:{highContrast:!1,screenReader:!1,fontSize:"medium"}},performance:{enableMonitoring:!0,logLevel:"info",metricsCollection:!0}},this.initialized=!1}initialize(){this.initialized||(this.loadFromStorage(),this.setDefaults(),this.initialized=!0)}loadFromStorage(){if("undefined"!=typeof localStorage)try{const e=localStorage.getItem("ilearnhow-config");if(e){const t=JSON.parse(e);this.config={...this.config,...t}}}catch(e){console.warn("Failed to load configuration from storage:",e)}}saveToStorage(){if("undefined"!=typeof localStorage)try{localStorage.setItem("ilearnhow-config",JSON.stringify(this.config))}catch(e){console.warn("Failed to save configuration to storage:",e)}}setDefaults(){"undefined"!=typeof process&&process.env.CLAUDE_API_KEY&&(this.config.claude.apiKey=process.env.CLAUDE_API_KEY),this.config.ui.theme||(this.config.ui.theme="light"),this.config.ui.language||(this.config.ui.language="english")}get(e){const t=e.split(".");let s=this.config;for(const e of t){if(!s||"object"!=typeof s||!(e in s))return;s=s[e]}return s}set(e,t){const s=e.split("."),i=s.pop();let r=this.config;for(const e of s)r[e]&&"object"==typeof r[e]||(r[e]={}),r=r[e];r[i]=t,this.saveToStorage()}setClaudeAPIKey(e){this.set("claude.apiKey",e)}getClaudeAPIKey(){return this.get("claude.apiKey")}isClaudeAPIConfigured(){return!!this.getClaudeAPIKey()}getAll(){return{...this.config}}reset(){this.config={claude:{apiKey:null,model:"claude-3-5-sonnet-20241022",maxTokens:2e3,timeout:3e4},synthesis:{cacheSize:1e3,performanceBudget:200,enableClaudeAPI:!0,fallbackToTemplates:!0},ui:{theme:"light",language:"english",accessibility:{highContrast:!1,screenReader:!1,fontSize:"medium"}},performance:{enableMonitoring:!0,logLevel:"info",metricsCollection:!0}},this.saveToStorage()}}},626:function(e,t,s){s.d(t,{Vy:function(){return n}});const i={ERROR:0,WARN:1,INFO:2,DEBUG:3,TRACE:4},r={[i.ERROR]:"ERROR",[i.WARN]:"WARN",[i.INFO]:"INFO",[i.DEBUG]:"DEBUG",[i.TRACE]:"TRACE"};class n{constructor(e,t={}){this.name=e,this.level=t.level||i.INFO,this.enabled=!1!==t.enabled,this.timestamp=!1!==t.timestamp,this.colors=!1!==t.colors,this.maxLogs=t.maxLogs||1e3,this.logs=[],this.colors={[i.ERROR]:"[31m",[i.WARN]:"[33m",[i.INFO]:"[36m",[i.DEBUG]:"[35m",[i.TRACE]:"[37m",reset:"[0m"}}error(e,...t){this.log(i.ERROR,e,...t)}warn(e,...t){this.log(i.WARN,e,...t)}info(e,...t){this.log(i.INFO,e,...t)}debug(e,...t){this.log(i.DEBUG,e,...t)}trace(e,...t){this.log(i.TRACE,e,...t)}log(e,t,...s){if(!this.enabled||e>this.level)return;const i={timestamp:this.timestamp?(new Date).toISOString():"",level:e,levelName:r[e],name:this.name,message:t,args:s,time:Date.now()};this.storeLog(i),this.outputToConsole(i)}storeLog(e){this.logs.push(e),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs))}outputToConsole(e){const{timestamp:t,levelName:s,name:r,message:n,args:o}=e;let a="";if(this.colors){const i=this.colors[e.level],o=this.colors.reset;t&&(a+=`${i}[${t}]${o} `),a+=`${i}[${s}]${o} `,a+=`${i}[${r}]${o} `,a+=`${i}${n}${o}`}else t&&(a+=`[${t}] `),a+=`[${s}] `,a+=`[${r}] `,a+=n;switch(e.level){case i.ERROR:console.error(a,...o);break;case i.WARN:console.warn(a,...o);break;case i.INFO:console.info(a,...o);break;case i.DEBUG:console.debug(a,...o);break;case i.TRACE:console.trace(a,...o);break;default:console.log(a,...o)}}setLevel(e){this.level=e}setEnabled(e){this.enabled=e}getRecentLogs(e=10,t=i.ERROR){return this.logs.filter(e=>e.level>=t).slice(-e)}getLogsByLevel(e){return this.logs.filter(t=>t.level===e)}getLogStats(){const e={total:this.logs.length,byLevel:{}};return Object.values(i).forEach(t=>{"number"==typeof t&&(e.byLevel[r[t]]=this.getLogsByLevel(t).length)}),e}clearLogs(){this.logs=[]}exportLogs(e={}){const{format:t="json",level:s=i.ERROR,count:r}=e;let n=this.logs.filter(e=>e.level>=s);switch(r&&(n=n.slice(-r)),t){case"json":return{name:this.name,timestamp:Date.now(),logs:n.map(e=>({timestamp:e.timestamp,level:e.levelName,name:e.name,message:e.message,args:e.args}))};case"text":return n.map(e=>`[${e.timestamp}] [${e.levelName}] [${e.name}] ${e.message}`).join("\n");default:return n}}createChild(e,t={}){const s=`${this.name}:${e}`;return new n(s,{level:this.level,enabled:this.enabled,timestamp:this.timestamp,colors:this.colors,...t})}}const o=new class{constructor(){this.loggers=new Map,this.defaultOptions={level:i.INFO,enabled:!0,timestamp:!0,colors:!0}}getLogger(e,t={}){if(!this.loggers.has(e)){const s={...this.defaultOptions,...t};this.loggers.set(e,new n(e,s))}return this.loggers.get(e)}setDefaultOptions(e){this.defaultOptions={...this.defaultOptions,...e}}setGlobalLevel(e){this.loggers.forEach(t=>t.setLevel(e))}setGlobalEnabled(e){this.loggers.forEach(t=>t.setEnabled(e))}getAllLoggers(){return this.loggers}getStats(){const e={totalLoggers:this.loggers.size,loggers:{}};return this.loggers.forEach((t,s)=>{e.loggers[s]=t.getLogStats()}),e}exportAllLogs(e={}){const t={timestamp:Date.now(),loggers:{}};return this.loggers.forEach((s,i)=>{t.loggers[i]=s.exportLogs(e)}),t}clearAllLogs(){this.loggers.forEach(e=>e.clearLogs())}};o.getLogger("Default")},651:function(e,t,s){s.d(t,{zc:function(){return n}});var i=s(626);class r{constructor(){this.marks=new Map,this.measures=new Map,this.observers=[],this.enabled=!0}static mark(e,t={}){if(this.enabled)try{performance.mark(e,t),this.marks.set(e,{timestamp:performance.now(),options:t})}catch(t){console.warn(`Failed to mark performance: ${e}`,t)}}static measure(e,t,s,i={}){if(this.enabled)try{performance.measure(e,t,s,i),this.measures.set(e,{startMark:t,endMark:s,options:i,timestamp:performance.now()})}catch(t){console.warn(`Failed to measure performance: ${e}`,t)}}static getEntry(e){return performance.getEntriesByName(e)[0]}static getAllEntries(){return performance.getEntries()}static clearEntries(e){e?(performance.clearMarks(e),performance.clearMeasures(e)):(performance.clearMarks(),performance.clearMeasures())}static setEnabled(e){this.enabled=e}static isEnabled(){return this.enabled}}r.enabled=!0;class n{constructor(){this.logger=new i.Vy("ErrorHandler"),this.errorCount=0,this.maxErrors=100,this.errors=[],this.recoveryStrategies=new Map,this.fallbackHandlers=new Map,this.initializeDefaultStrategies(),this.setupGlobalHandlers()}initializeDefaultStrategies(){this.addRecoveryStrategy("synthesis-failure",(e,t)=>({type:"fallback-content",content:this.getFallbackContent(t),error:e.message})),this.addRecoveryStrategy("network-error",(e,t)=>({type:"retry",retryCount:3,delay:1e3,error:e.message})),this.addRecoveryStrategy("data-load-error",(e,t)=>({type:"fallback-data",data:this.getFallbackData(t),error:e.message})),this.addRecoveryStrategy("validation-error",(e,t)=>({type:"sanitize",sanitizedData:this.sanitizeData(t.data),error:e.message}))}setupGlobalHandlers(){window.addEventListener("unhandledrejection",e=>{this.handleError(e.reason,{context:"unhandled-rejection"}),e.preventDefault()}),window.addEventListener("error",e=>{this.handleError(e.error,{context:"global-error",filename:e.filename,lineno:e.lineno,colno:e.colno})})}handleError(e,t={}){const s=this.generateErrorId(),i=Date.now();this.logger.error(`Error ${s}:`,e,t),this.recordError(e,t,s,i);const r=this.classifyError(e,t),n=this.attemptRecovery(r,e,t);return this.errorCount++,this.errorCount>this.maxErrors&&(this.logger.warn("Maximum error count reached, clearing old errors"),this.clearOldErrors()),{errorId:s,errorType:r,recoveryResult:n,timestamp:i,handled:!0}}classifyError(e,t){const s=e.message.toLowerCase();e.stack.toLowerCase();return s.includes("fetch")||s.includes("network")||s.includes("timeout")||s.includes("connection")?"network-error":s.includes("synthesis")||s.includes("synthesize")||"synthesis"===t.context?"synthesis-failure":s.includes("load")||s.includes("data")||s.includes("json")||s.includes("parse")?"data-load-error":s.includes("validation")||s.includes("invalid")||s.includes("required")||s.includes("type")?"validation-error":"generic-error"}attemptRecovery(e,t,s){const i=this.recoveryStrategies.get(e);if(i)try{return i(t,s)}catch(e){return this.logger.error("Recovery strategy failed:",e),this.getFallbackRecovery(t,s)}return this.getFallbackRecovery(t,s)}addRecoveryStrategy(e,t){this.recoveryStrategies.set(e,t)}addFallbackHandler(e,t){this.fallbackHandlers.set(e,t)}getFallbackRecovery(e,t){return{type:"fallback",message:"Using fallback recovery mechanism",error:e.message,context:t}}getFallbackContent(e){return{title:"Learning Content",introduction:"Welcome to today's lesson. We're here to learn together.",concept:"Today we'll explore an important concept that will help you grow.",examples:"Think about how this applies to your daily life.",reflection:"What did you learn today?",metadata:{isFallback:!0,fallbackReason:e.error||"Unknown error",timestamp:Date.now()}}}getFallbackData(e){return{title:"The Sun - Our Magnificent Life-Giving Star",concept:"The sun is the center of our solar system and provides energy for life on Earth.",examples:["Plants use sunlight to make food through photosynthesis","Solar panels convert sunlight into electricity","The sun's gravity keeps planets in orbit"],reflection:"How does the sun affect your daily life?",isFallback:!0}}sanitizeData(e){if("string"==typeof e)return e.trim().replace(/[<>]/g,"");if("object"==typeof e&&null!==e){const t={};for(const[s,i]of Object.entries(e))t[s]=this.sanitizeData(i);return t}return e}recordError(e,t,s,i){const r={id:s,message:e.message,stack:e.stack,context:t,timestamp:i,type:this.classifyError(e,t)};this.errors.push(r),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors))}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}clearOldErrors(){const e=Date.now()-36e5;this.errors=this.errors.filter(t=>t.timestamp>e),this.errorCount=this.errors.length}getErrorStats(){const e={};return this.errors.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),{totalErrors:this.errorCount,recentErrors:this.errors.length,errorTypes:e,lastError:this.errors[this.errors.length-1]||null}}getRecentErrors(e=10){return this.errors.slice(-e)}reset(){this.errors=[],this.errorCount=0,this.logger.info("Error handler reset complete")}}new n}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e](n,n.exports,r),n.exports}r.m=s,r.d=function(e,t){for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce(function(t,s){return r.f[s](e,t),t},[]))},r.u=function(e){return"assets/js/"+e+"."+{122:"e0b47d9249e05330d585",610:"bb4b06d5f996bc5cc60f",625:"7a41469ad5158e4cc796",895:"87353e410125b10617e9",979:"8faddf9276d477093878"}[e]+".js"},r.miniCssF=function(e){},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="mynextlesson-synthesis:",r.l=function(s,i,n,o){if(e[s])e[s].push(i);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==t+n){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",t+n),a.src=s),e[s]=[i];var g=function(t,i){a.onerror=a.onload=null,clearTimeout(m);var r=e[s];if(delete e[s],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach(function(e){return e(i)}),t)return t(i)},m=setTimeout(g.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=g.bind(null,a.onerror),a.onload=g.bind(null,a.onload),l&&document.head.appendChild(a)}},r.p="/",function(){var e={792:0};r.f.j=function(t,s){var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var n=new Promise(function(s,r){i=e[t]=[s,r]});s.push(i[2]=n);var o=r.p+r.u(t),a=new Error;r.l(o,function(s){if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",a.name="ChunkLoadError",a.type=n,a.request=o,i[1](a)}},"chunk-"+t,t)}};var t=function(t,s){var i,n,o=s[0],a=s[1],l=s[2],c=0;if(o.some(function(t){return 0!==e[t]})){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)l(r)}for(t&&t(s);c<o.length;c++)n=o[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0},s=self.webpackChunkmynextlesson_synthesis=self.webpackChunkmynextlesson_synthesis||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var n=r(651),o=r(626);class a{constructor(){this.metrics={synthesisCount:0,cacheHits:0,cacheMisses:0,averageSynthesisTime:0,totalSynthesisTime:0,errors:0,lastReset:(new Date).toISOString()}}recordSynthesis(e,t){const s=performance.now()-e;this.metrics.synthesisCount++,this.metrics.totalSynthesisTime+=s,this.metrics.averageSynthesisTime=this.metrics.totalSynthesisTime/this.metrics.synthesisCount,this.recordDetailedMetrics({type:"synthesis",lessonId:t.lessonId,synthesisTime:s,tokensUsed:t.performance?.tokensUsed||0,cost:t.cost,success:t.success,timestamp:(new Date).toISOString()}),this.checkPerformanceThresholds(s,t),console.log(`Synthesis recorded: ${s.toFixed(2)}ms, Cost: $${t.cost?.toFixed(4)||0}`)}recordCacheHit(e){const t=performance.now()-e;this.metrics.cacheHits++,this.recordDetailedMetrics({type:"cache_hit",responseTime:t,timestamp:(new Date).toISOString()}),console.log(`Cache hit recorded: ${t.toFixed(2)}ms`)}recordCacheMiss(e){const t=performance.now()-e;this.metrics.cacheMisses++,this.recordDetailedMetrics({type:"cache_miss",responseTime:t,timestamp:(new Date).toISOString()}),console.log(`Cache miss recorded: ${t.toFixed(2)}ms`)}recordError(e,t={}){this.metrics.errors++,this.recordDetailedMetrics({type:"error",error:e.message,stack:e.stack,context:t,timestamp:(new Date).toISOString()}),console.error("Error recorded:",e.message,t)}recordDetailedMetrics(e){try{Date.now(),Math.random().toString(36).substr(2,9);console.log("Detailed metric:",e)}catch(e){console.error("Record detailed metrics error:",e)}}checkPerformanceThresholds(e,t){e>5e3?this.recordError(new Error(`Synthesis time exceeded maximum threshold: ${e}ms`),{lessonId:t.lessonId,synthesisTime:e,threshold:5e3}):e>200&&console.warn(`Synthesis time above target: ${e}ms (target: 200ms)`);t.cost>.05&&console.warn(`Cost exceeded threshold: $${t.cost} (max: $0.05)`)}getMetrics(){const e=this.metrics.synthesisCount>0?this.metrics.cacheHits/(this.metrics.cacheHits+this.metrics.cacheMisses)*100:0;return{...this.metrics,cacheHitRate:e.toFixed(2)+"%",errorRate:this.metrics.synthesisCount>0?this.metrics.errors/this.metrics.synthesisCount*100:0,timestamp:(new Date).toISOString()}}async getPerformanceStats(e=24){try{return{period:`${e} hours`,synthesis:{total:this.metrics.synthesisCount,averageTime:this.metrics.averageSynthesisTime,totalTime:this.metrics.totalSynthesisTime},cache:{hits:this.metrics.cacheHits,misses:this.metrics.cacheMisses,hitRate:this.metrics.synthesisCount>0?this.metrics.cacheHits/(this.metrics.cacheHits+this.metrics.cacheMisses)*100:0},errors:{total:this.metrics.errors,rate:this.metrics.synthesisCount>0?this.metrics.errors/this.metrics.synthesisCount*100:0},thresholds:{targetSynthesisTime:200,maxSynthesisTime:5e3,maxCostPerLesson:.05},timestamp:(new Date).toISOString()}}catch(e){return console.error("Get performance stats error:",e),{error:e.message}}}resetMetrics(){this.metrics={synthesisCount:0,cacheHits:0,cacheMisses:0,averageSynthesisTime:0,totalSynthesisTime:0,errors:0,lastReset:(new Date).toISOString()},console.log("Performance metrics reset")}async getHealthCheck(){try{const e=this.getMetrics(),t={status:"healthy",checks:{synthesisCount:e.synthesisCount>=0,averageSynthesisTime:e.averageSynthesisTime<5e3,errorRate:e.errors/Math.max(e.synthesisCount,1)<.1,cacheHitRate:parseFloat(e.cacheHitRate)>0},metrics:e,timestamp:(new Date).toISOString()},s=Object.values(t.checks).every(e=>e);return t.status=s?"healthy":"degraded",t}catch(e){return console.error("Health check error:",e),{status:"unhealthy",error:e.message,timestamp:(new Date).toISOString()}}}async getAlerts(){try{const e=[],t=this.getMetrics();t.averageSynthesisTime>3e3&&e.push({type:"performance_degradation",message:`Average synthesis time is high: ${t.averageSynthesisTime.toFixed(2)}ms`,severity:"warning",threshold:3e3,current:t.averageSynthesisTime});const s=t.errors/Math.max(t.synthesisCount,1)*100;s>5&&e.push({type:"high_error_rate",message:`Error rate is high: ${s.toFixed(2)}%`,severity:"critical",threshold:5,current:s});const i=parseFloat(t.cacheHitRate);return i<50&&e.push({type:"low_cache_hit_rate",message:`Cache hit rate is low: ${i.toFixed(2)}%`,severity:"warning",threshold:50,current:i}),{alerts:e,count:e.length,timestamp:(new Date).toISOString()}}catch(e){return console.error("Get alerts error:",e),{error:e.message}}}}const l=new class{constructor(){this.baseUrl="https://ilearnhow-enterprise-synthesis.nicoletterankin.workers.dev",this.clientId=this.generateClientId()}generateClientId(){let e=localStorage.getItem("ilearnhow-client-id");return e||(e="client_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("ilearnhow-client-id",e)),e}async checkHealth(){try{const e=await fetch(`${this.baseUrl}/api/health`);if(!e.ok)throw new Error(`Health check failed: ${e.status}`);return await e.json()}catch(e){throw console.error("API health check failed:",e),e}}async synthesizeLesson(e,t,s){try{const i=performance.now(),r={lessonContent:e,age:t,tone:s,clientId:this.clientId};console.log("API Request Body:",r);const n=await fetch(`${this.baseUrl}/api/synthesize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||`API request failed: ${n.status}`)}const o=await n.json(),a=performance.now()-i;return{title:`Personalized Lesson for Age ${t}`,content:o.content,metadata:{age:t,tone:s,synthesisTime:o.synthesisTime||a,cost:o.cost,cached:o.cached,generated:(new Date).toISOString(),clientId:this.clientId}}}catch(e){throw console.error("Synthesis API call failed:",e),e}}async getStats(){try{const e=await fetch(`${this.baseUrl}/api/stats`);if(!e.ok)throw new Error(`Stats request failed: ${e.status}`);return await e.json()}catch(e){throw console.error("Stats API call failed:",e),e}}async testConnection(){try{const e=await this.checkHealth();return console.log("API Health Check:",e),!0}catch(e){return console.error("API Connection Test Failed:",e),!1}}};class c{constructor(){this.logger=new o.Vy("LessonController"),this.currentLesson=null,this.currentParams={age:25,tone:"grandmother",language:"english",day:this.getCurrentDay()},this.isLoading=!1,this.synthesisTime=0,this.listeners=new Set}getCurrentDay(){const e=new Date,t=new Date(e.getFullYear(),0,0),s=e-t;return Math.floor(s/864e5)}async initialize(){this.logger.info("Initializing lesson controller...");try{try{await l.checkHealth(),console.log("LessonController: API health check passed")}catch(e){console.warn("LessonController: API health check failed, will use fallback mode:",e.message)}return await this.loadLesson(),this.logger.info("Lesson controller initialized successfully"),!0}catch(e){return this.logger.error("Failed to initialize lesson controller:",e),!1}}async loadLesson(){if(!this.isLoading){this.isLoading=!0,this.notifyListeners("loading",{isLoading:!0});try{this.logger.info("Loading lesson with params:",this.currentParams);const e=performance.now(),t=await l.synthesizeLesson(this.getLessonContent(),this.currentParams.age,this.currentParams.tone);this.synthesisTime=performance.now()-e,this.currentLesson=t,this.logger.info(`Lesson loaded successfully in ${this.synthesisTime}ms`),this.notifyListeners("lessonLoaded",{lesson:this.currentLesson,synthesisTime:this.synthesisTime,params:this.currentParams})}catch(e){this.logger.error("Failed to load lesson:",e);const t=this.getFallbackContent();this.currentLesson=t,this.synthesisTime=0,this.notifyListeners("lessonLoaded",{lesson:this.currentLesson,synthesisTime:0,params:this.currentParams,error:e.message}),this.notifyListeners("error",{error:`API unavailable: ${e.message}. Showing fallback content.`})}finally{this.isLoading=!1,this.notifyListeners("loading",{isLoading:!1})}}}getFallbackContent(){const e=this.getLessonContent(),t=this.currentParams.age,s=this.currentParams.tone;let i="";switch(s){case"grandmother":i="Dear one, ";break;case"fun":i="Hey there! ";break;default:i=""}return{title:`Learning About: ${e.split(" ").slice(0,4).join(" ")}...`,content:`${i}${e} This is a fallback lesson while our synthesis engine is being updated. The real lesson would be personalized just for you!`,metadata:{age:t,tone:s,synthesisTime:0,cached:!1,generated:(new Date).toISOString(),fallback:!0}}}getLessonContent(){const e=["The sun is a star that provides light and heat to Earth. It is very hot and bright, and without it, life on Earth would not be possible.","Water is essential for life. It covers most of our planet and is found in oceans, rivers, and lakes. All living things need water to survive.","Plants use sunlight to make their own food through a process called photosynthesis. They take in carbon dioxide and release oxygen.","The human body is made up of many different systems that work together. The heart pumps blood, the lungs help us breathe, and the brain controls everything.","Electricity is a form of energy that powers many things in our world. It flows through wires and can be used to light bulbs, run computers, and charge phones."];return e[(this.currentParams.day-1)%e.length]}async updateAge(e){this.currentParams.age=parseInt(e),this.logger.info(`Age updated to ${e}`),this.notifyListeners("paramsChanged",{params:this.currentParams}),await this.loadLesson()}async updateTone(e){this.currentParams.tone=e,this.logger.info(`Tone updated to ${e}`),this.notifyListeners("paramsChanged",{params:this.currentParams}),await this.loadLesson()}async updateLanguage(e){this.currentParams.language=e,this.logger.info(`Language updated to ${e}`),this.notifyListeners("paramsChanged",{params:this.currentParams}),await this.loadLesson()}getCurrentLesson(){return this.currentLesson}getCurrentParams(){return{...this.currentParams}}getSynthesisTime(){return this.synthesisTime}isLoading(){return this.isLoading}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e,t){this.listeners.forEach(s=>{try{s(e,t)}catch(e){this.logger.error("Listener error:",e)}})}}class h{constructor(){this.logger=new o.Vy("ReactiveUI"),this.controller=new c,this.elements={},this.isInitialized=!1}async initialize(){this.logger.info("Initializing reactive UI..."),console.log("ReactiveUI: Starting initialization...");try{this.cacheElements(),console.log("ReactiveUI: DOM elements cached:",Object.keys(this.elements)),this.setupEventListeners(),console.log("ReactiveUI: Event listeners set up"),console.log("ReactiveUI: Initializing lesson controller...");await this.controller.initialize()?console.log("ReactiveUI: Lesson controller initialized"):console.warn("ReactiveUI: Lesson controller failed to initialize, but continuing with fallback mode"),this.setupControllerListeners(),console.log("ReactiveUI: Controller listeners set up"),this.isInitialized=!0,this.logger.info("Reactive UI initialized successfully"),console.log("ReactiveUI: Initialization complete!")}catch(e){this.logger.error("Failed to initialize reactive UI:",e),console.error("ReactiveUI: Initialization failed:",e),this.showError("Failed to initialize the application. Please refresh the page.")}}cacheElements(){this.elements={ageSlider:document.getElementById("age-slider"),ageDisplay:document.getElementById("age-display"),toneButtons:document.querySelectorAll(".tone-button"),languageSelect:document.getElementById("language-select"),lessonTitle:document.getElementById("lesson-title"),lessonContent:document.getElementById("lesson-content"),introduction:document.getElementById("introduction"),coreConcept:document.getElementById("core-concept"),examples:document.getElementById("examples"),reflection:document.getElementById("reflection"),synthesisTime:document.getElementById("synthesis-time"),loadingIndicators:document.querySelectorAll(".loading-indicator"),experienceButton:document.getElementById("experience-button"),errorDisplay:document.getElementById("error-display")}}setupEventListeners(){this.elements.ageSlider&&this.elements.ageSlider.addEventListener("input",e=>{const t=e.target.value;this.updateAgeDisplay(t),this.controller.updateAge(t)}),this.elements.toneButtons.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.tone;this.updateToneSelection(t),this.controller.updateTone(t)})}),this.elements.languageSelect&&this.elements.languageSelect.addEventListener("change",e=>{const t=e.target.value;this.controller.updateLanguage(t)}),this.elements.experienceButton&&this.elements.experienceButton.addEventListener("click",()=>{this.handleExperienceClick()})}setupControllerListeners(){this.controller.addListener((e,t)=>{switch(e){case"loading":this.handleLoading(t.isLoading);break;case"lessonLoaded":this.handleLessonLoaded(t);break;case"paramsChanged":this.handleParamsChanged(t);break;case"error":this.handleError(t.error)}})}handleLoading(e){this.logger.info(`Loading state changed: ${e}`),this.elements.loadingIndicators.forEach(t=>{e?(t.style.display="block",t.textContent="Synthesizing your personalized lesson..."):t.style.display="none"});[this.elements.ageSlider,...this.elements.toneButtons,this.elements.languageSelect,this.elements.experienceButton].forEach(t=>{t&&(t.disabled=e)})}handleLessonLoaded(e){this.logger.info("Lesson loaded, updating UI");const{lesson:t,synthesisTime:s,params:i}=e;this.elements.lessonTitle&&(this.elements.lessonTitle.textContent=t.title),this.elements.lessonContent&&(this.elements.lessonContent.textContent=t.content),this.elements.synthesisTime&&(this.elements.synthesisTime.textContent=`${Math.round(s)}ms`),this.updateContentSections(t.content),this.elements.loadingIndicators.forEach(e=>{e.style.display="none"});[this.elements.ageSlider,...this.elements.toneButtons,this.elements.languageSelect,this.elements.experienceButton].forEach(e=>{e&&(e.disabled=!1)})}updateContentSections(e){const t=this.splitContentIntoSections(e);this.elements.introduction&&(this.elements.introduction.textContent=t.introduction||"Your personalized introduction is being prepared..."),this.elements.coreConcept&&(this.elements.coreConcept.textContent=t.coreConcept||"Your personalized core concept is being prepared..."),this.elements.examples&&(this.elements.examples.textContent=t.examples||"Your personalized examples are being prepared..."),this.elements.reflection&&(this.elements.reflection.textContent=t.reflection||"Your personalized reflection question is being prepared...")}splitContentIntoSections(e){const t=e.split(". "),s=Math.ceil(t.length/4);return{introduction:t.slice(0,s).join(". ")+".",coreConcept:t.slice(s,2*s).join(". ")+".",examples:t.slice(2*s,3*s).join(". ")+".",reflection:t.slice(3*s).join(". ")+"."}}handleParamsChanged(e){this.logger.info("Parameters changed:",e.params)}handleError(e){console.error("ReactiveUI: Controller error:",e);let t="Something went wrong while loading your lesson.";e.error&&e.error.includes("API unavailable")?t="Our synthesis engine is temporarily unavailable. Showing you a preview lesson instead.":e.error&&e.error.includes("network")?t="Network connection issue. Please check your internet and try again.":e.error&&e.error.includes("rate limit")&&(t="Too many requests. Please wait a moment and try again."),this.showError(t),setTimeout(()=>{this.elements.errorDisplay&&(this.elements.errorDisplay.style.display="none")},8e3)}updateAgeDisplay(e){this.elements.ageDisplay&&(this.elements.ageDisplay.textContent=`${e} years old`)}updateToneSelection(e){this.elements.toneButtons.forEach(t=>{t.dataset.tone===e?t.classList.add("selected"):t.classList.remove("selected")})}handleExperienceClick(){this.logger.info("Experience button clicked");const e=this.controller.getCurrentLesson();e&&alert(`Enhanced lesson experience coming soon!\n\nCurrent lesson: ${e.title}\n\nThis feature will include audio narration, interactive elements, and more!`)}showError(e){if(console.error("ReactiveUI Error:",e),this.elements.errorDisplay){const t=this.elements.errorDisplay.querySelector("#error-message");t&&(t.textContent=e),this.elements.errorDisplay.style.display="block"}console.error("User-facing error:",e)}getCurrentLesson(){return this.controller.getCurrentLesson()}getCurrentParams(){return this.controller.getCurrentParams()}isReady(){return this.isInitialized}}var d=r(452);window.Application=new class{constructor(){this.engine=null,this.performanceMonitor=null,this.isInitialized=!1,this.startTime=performance.now(),this.logger=new o.Vy("ApplicationBootstrap")}async initialize(){try{this.logger.info("bootstrap_start","Initializing enterprise synthesis platform"),await this.initializeCoreSystems(),console.log("DEBUG: About to call initializeReactiveUI...");try{await this.initializeReactiveUI(),console.log("DEBUG: initializeReactiveUI completed successfully")}catch(e){throw console.error("DEBUG: Error in initializeReactiveUI:",e),e}console.log("DEBUG: About to call validateSystemReadiness..."),await this.validateSystemReadiness(),this.isInitialized=!0;const e=performance.now()-this.startTime;return this.logger.info("bootstrap_complete",`Application initialized in ${e.toFixed(2)}ms`),this.triggerReadyEvent(),!0}catch(e){return(new n.zc).handleError(e,{context:"bootstrap",phase:"initialization"}),!1}}async initializeCoreSystems(){this.logger.info("bootstrap_core","Initializing core systems"),console.log("DEBUG: Starting initializeCoreSystems...");try{console.log("DEBUG: About to initialize config..."),d.$.initialize(),console.log("DEBUG: Config initialized successfully"),console.log("DEBUG: About to initialize performance monitor...");try{this.performanceMonitor=new a,console.log("DEBUG: PerformanceMonitor instance created"),await this.performanceMonitor.initialize(),console.log("DEBUG: Performance monitor initialized successfully")}catch(e){throw console.error("DEBUG: Error in performance monitor initialization:",e),e}console.log("DEBUG: About to setup global error handling..."),this.setupGlobalErrorHandling(),console.log("DEBUG: Global error handling setup complete"),this.logger.info("bootstrap_core_complete","Core systems initialized"),console.log("DEBUG: Core systems completed, moving to ReactiveUI...")}catch(e){throw console.error("DEBUG: Error in initializeCoreSystems:",e),e}}async initializeReactiveUI(){console.log("DEBUG: Starting ReactiveUI initialization..."),this.logger.info("bootstrap_ui","Initializing reactive UI"),this.reactiveUI=new h,console.log("DEBUG: ReactiveUI instance created, calling initialize..."),await this.reactiveUI.initialize(),this.logger.info("bootstrap_ui_complete","Reactive UI initialized"),console.log("DEBUG: ReactiveUI initialization completed")}async initializeUIComponents(){this.logger.info("bootstrap_ui","Initializing UI components"),await this.initializeLessonPlayer(),await this.initializeCalendarOverlay(),await this.initializeSynthesisControls(),await this.initializeAccessibility(),this.logger.info("bootstrap_ui_complete","UI components initialized")}async initializeLessonPlayer(){try{const{LessonPlayer:e}=await r.e(625).then(r.bind(r,625));this.lessonPlayer=new e(this.engine),await this.lessonPlayer.initialize()}catch(e){throw o.Vy.error("bootstrap_lesson_player_failed",e),e}}async initializeCalendarOverlay(){try{const{CalendarOverlay:e}=await r.e(895).then(r.bind(r,895));this.calendarOverlay=new e,await this.calendarOverlay.initialize()}catch(e){throw o.Vy.error("bootstrap_calendar_failed",e),e}}async initializeSynthesisControls(){try{const{SynthesisControls:e}=await r.e(979).then(r.bind(r,979));this.synthesisControls=new e(this.engine),await this.synthesisControls.initialize()}catch(e){throw o.Vy.error("bootstrap_controls_failed",e),e}}async initializeAccessibility(){try{const{Accessibility:e}=await r.e(610).then(r.bind(r,610));this.accessibility=new e,await this.accessibility.initialize()}catch(e){throw o.Vy.error("bootstrap_accessibility_failed",e),e}}setupGlobalErrorHandling(){window.addEventListener("unhandledrejection",e=>{n.zc.handle(e.reason,{context:"global",type:"unhandled_rejection"}),e.preventDefault()}),window.addEventListener("error",e=>{n.zc.handle(e.error,{context:"global",type:"global_error"})}),window.addEventListener("error",e=>{e.target!==window&&n.zc.handle(new Error(`Resource load failed: ${e.target.src||e.target.href}`),{context:"global",type:"resource_error",resource:e.target.src||e.target.href})},!0)}async validateSystemReadiness(){this.logger.info("bootstrap_validation","Validating system readiness");const e=[this.validateReactiveUI(),this.validateCurriculum(),this.validatePerformance(),this.validateUIComponents()],t=(await Promise.allSettled(e)).filter(e=>"rejected"===e.status);if(t.length>0)throw new Error(`System validation failed: ${t.length} components failed validation`);this.logger.info("bootstrap_validation_complete","System validation successful")}async validateReactiveUI(){if(!this.reactiveUI||!this.reactiveUI.isReady())throw new Error("Reactive UI not ready");const e=performance.now(),t=this.reactiveUI.getCurrentLesson(),s=performance.now()-e;if(s>d.$.get("performance.synthesis.maxTime"))throw new Error(`UI performance below threshold: ${s}ms`);if(!t||!t.title)throw new Error("Test UI failed to produce valid lesson")}async validateCurriculum(){this.logger.info("bootstrap_validation","Curriculum validation skipped - using templates")}async validatePerformance(){if(!this.performanceMonitor||!this.performanceMonitor.isReady())throw new Error("Performance monitoring not ready")}async validateUIComponents(){this.logger.info("bootstrap_validation","UI components validation skipped - using reactive UI only")}triggerReadyEvent(){const e=new CustomEvent("application:ready",{detail:{initializationTime:performance.now()-this.startTime,reactiveUI:this.reactiveUI,components:{lessonPlayer:this.lessonPlayer,calendarOverlay:this.calendarOverlay,synthesisControls:this.synthesisControls,accessibility:this.accessibility}}});window.dispatchEvent(e)}getStatus(){return{isInitialized:this.isInitialized,initializationTime:performance.now()-this.startTime,reactiveUI:!!this.reactiveUI&&this.reactiveUI.isReady(),performance:this.performanceMonitor?this.performanceMonitor.getStatus():null,components:{lessonPlayer:this.lessonPlayer?this.lessonPlayer.getStatus():null,calendarOverlay:this.calendarOverlay?this.calendarOverlay.getStatus():null,synthesisControls:this.synthesisControls?this.synthesisControls.getStatus():null,accessibility:this.accessibility?this.accessibility.getStatus():null}}}async shutdown(){this.logger.info("bootstrap_shutdown","Shutting down application");try{this.accessibility&&await this.accessibility.shutdown(),this.synthesisControls&&await this.synthesisControls.shutdown(),this.calendarOverlay&&await this.calendarOverlay.shutdown(),this.lessonPlayer&&await this.lessonPlayer.shutdown(),this.engine&&await this.engine.shutdown(),this.performanceMonitor&&await this.performanceMonitor.shutdown(),this.isInitialized=!1,this.logger.info("bootstrap_shutdown_complete","Application shutdown complete")}catch(e){throw o.Vy.error("bootstrap_shutdown_failed",e),e}}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.Application.initialize()}):window.Application.initialize();window.Application}();