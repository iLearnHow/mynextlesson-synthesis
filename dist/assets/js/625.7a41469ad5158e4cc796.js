"use strict";(self.webpackChunkmynextlesson_synthesis=self.webpackChunkmynextlesson_synthesis||[]).push([[625],{625:function(e,t,s){s.d(t,{LessonPlayer:function(){return r}});var n=s(626),i=s(651),a=s(452);class r{constructor(e){this.engine=e,this.currentLesson=null,this.currentParams=null,this.isPlaying=!1,this.isReady=!1,this.audioContext=null,this.audioElement=null,this.progressTracker=null,this.eventListeners=new Map,this.container=null,this.lessonContent=null,this.controls=null,this.progressBar=null,this.statusIndicator=null}async initialize(){try{n.Vy.info("lesson_player_init","Initializing lesson player"),await this.initializeAudio(),await this.setupUI(),await this.initializeProgressTracking(),this.setupEventListeners(),this.isReady=!0,n.Vy.info("lesson_player_ready","Lesson player initialized successfully")}catch(e){throw i.zc.handle(e,{context:"lesson_player",phase:"initialization"}),e}}async initializeAudio(){try{(window.AudioContext||window.webkitAudioContext)&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext),"suspended"===this.audioContext.state&&await this.audioContext.resume()),this.audioElement=document.createElement("audio"),this.audioElement.preload="none",this.audioElement.controls=!1,n.Vy.info("lesson_player_audio_ready","Audio context initialized")}catch(e){n.Vy.warn("lesson_player_audio_failed","Audio initialization failed, using fallback"),this.audioContext=null}}async setupUI(){this.container=document.getElementById("lesson-player")||this.createContainer(),this.lessonContent=this.createLessonContent(),this.controls=this.createControls(),this.progressBar=this.createProgressBar(),this.statusIndicator=this.createStatusIndicator(),this.assembleUI(),n.Vy.info("lesson_player_ui_ready","UI elements created and assembled")}createContainer(){const e=document.createElement("div");e.id="lesson-player",e.className="lesson-player-container",e.setAttribute("role","main"),e.setAttribute("aria-label","Lesson Player");return(document.querySelector("main")||document.body).appendChild(e),e}createLessonContent(){const e=document.createElement("div");return e.className="lesson-content",e.setAttribute("role","region"),e.setAttribute("aria-label","Lesson Content"),e.innerHTML='\n            <div class="lesson-loading">\n                <div class="loading-spinner"></div>\n                <p>Loading your personalized lesson...</p>\n            </div>\n        ',e}createControls(){const e=document.createElement("div");return e.className="lesson-controls",e.setAttribute("role","toolbar"),e.setAttribute("aria-label","Lesson Controls"),e.innerHTML='\n            <button class="control-btn play-btn" aria-label="Play Lesson" disabled>\n                <svg class="icon" viewBox="0 0 24 24">\n                    <path d="M8 5v14l11-7z"/>\n                </svg>\n            </button>\n            <button class="control-btn pause-btn" aria-label="Pause Lesson" disabled>\n                <svg class="icon" viewBox="0 0 24 24">\n                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>\n                </svg>\n            </button>\n            <button class="control-btn restart-btn" aria-label="Restart Lesson" disabled>\n                <svg class="icon" viewBox="0 0 24 24">\n                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>\n                </svg>\n            </button>\n            <div class="volume-control">\n                <button class="control-btn volume-btn" aria-label="Toggle Mute">\n                    <svg class="icon" viewBox="0 0 24 24">\n                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>\n                    </svg>\n                </button>\n                <input type="range" class="volume-slider" min="0" max="100" value="100" aria-label="Volume">\n            </div>\n        ',e}createProgressBar(){const e=document.createElement("div");return e.className="lesson-progress",e.setAttribute("role","progressbar"),e.setAttribute("aria-label","Lesson Progress"),e.setAttribute("aria-valuemin","0"),e.setAttribute("aria-valuemax","100"),e.setAttribute("aria-valuenow","0"),e.innerHTML='\n            <div class="progress-bar">\n                <div class="progress-fill"></div>\n            </div>\n            <div class="progress-time">\n                <span class="current-time">0:00</span>\n                <span class="total-time">0:00</span>\n            </div>\n        ',e}createStatusIndicator(){const e=document.createElement("div");return e.className="lesson-status",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.innerHTML='\n            <div class="status-icon"></div>\n            <span class="status-text">Ready</span>\n        ',e}assembleUI(){this.container.innerHTML="",this.container.appendChild(this.statusIndicator),this.container.appendChild(this.lessonContent),this.container.appendChild(this.progressBar),this.container.appendChild(this.controls),this.applyStyles()}applyStyles(){const e=`\n            .lesson-player-container {\n                max-width: 800px;\n                margin: 0 auto;\n                padding: 20px;\n                background: ${a.$.get("ui.theme.background")};\n                border-radius: 12px;\n                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n            \n            .lesson-content {\n                margin-bottom: 20px;\n                padding: 20px;\n                background: #f8fafc;\n                border-radius: 8px;\n                min-height: 200px;\n            }\n            \n            .lesson-loading {\n                text-align: center;\n                padding: 40px;\n            }\n            \n            .loading-spinner {\n                width: 40px;\n                height: 40px;\n                border: 4px solid #e2e8f0;\n                border-top: 4px solid ${a.$.get("ui.theme.primary")};\n                border-radius: 50%;\n                animation: spin 1s linear infinite;\n                margin: 0 auto 20px;\n            }\n            \n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n            \n            .lesson-controls {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 15px;\n                background: #f1f5f9;\n                border-radius: 8px;\n            }\n            \n            .control-btn {\n                background: ${a.$.get("ui.theme.primary")};\n                color: white;\n                border: none;\n                border-radius: 50%;\n                width: 44px;\n                height: 44px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n            \n            .control-btn:hover:not(:disabled) {\n                background: ${a.$.get("ui.theme.accent")};\n                transform: scale(1.05);\n            }\n            \n            .control-btn:disabled {\n                background: #cbd5e1;\n                cursor: not-allowed;\n            }\n            \n            .control-btn .icon {\n                width: 24px;\n                height: 24px;\n                fill: currentColor;\n            }\n            \n            .volume-control {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                margin-left: auto;\n            }\n            \n            .volume-slider {\n                width: 80px;\n                height: 4px;\n                background: #cbd5e1;\n                border-radius: 2px;\n                outline: none;\n            }\n            \n            .volume-slider::-webkit-slider-thumb {\n                appearance: none;\n                width: 16px;\n                height: 16px;\n                background: ${a.$.get("ui.theme.primary")};\n                border-radius: 50%;\n                cursor: pointer;\n            }\n            \n            .lesson-progress {\n                margin-bottom: 15px;\n            }\n            \n            .progress-bar {\n                width: 100%;\n                height: 6px;\n                background: #e2e8f0;\n                border-radius: 3px;\n                overflow: hidden;\n                margin-bottom: 10px;\n            }\n            \n            .progress-fill {\n                height: 100%;\n                background: ${a.$.get("ui.theme.primary")};\n                width: 0%;\n                transition: width 0.3s ease;\n            }\n            \n            .progress-time {\n                display: flex;\n                justify-content: space-between;\n                font-size: 14px;\n                color: #64748b;\n            }\n            \n            .lesson-status {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                margin-bottom: 15px;\n                padding: 10px;\n                background: #f0f9ff;\n                border-radius: 6px;\n                font-size: 14px;\n            }\n            \n            .status-icon {\n                width: 12px;\n                height: 12px;\n                border-radius: 50%;\n                background: ${a.$.get("ui.theme.success")};\n            }\n            \n            .lesson-title {\n                font-size: 24px;\n                font-weight: 700;\n                color: ${a.$.get("ui.theme.text")};\n                margin-bottom: 15px;\n            }\n            \n            .lesson-text {\n                font-size: 16px;\n                line-height: 1.6;\n                color: ${a.$.get("ui.theme.text")};\n                margin-bottom: 20px;\n            }\n            \n            .lesson-meta {\n                display: flex;\n                gap: 20px;\n                font-size: 14px;\n                color: #64748b;\n                margin-bottom: 20px;\n            }\n            \n            .meta-item {\n                display: flex;\n                align-items: center;\n                gap: 5px;\n            }\n        `;if(!document.getElementById("lesson-player-styles")){const t=document.createElement("style");t.id="lesson-player-styles",t.textContent=e,document.head.appendChild(t)}}async initializeProgressTracking(){try{const{ProgressTracker:e}=await s.e(122).then(s.bind(s,122));this.progressTracker=new e,await this.progressTracker.initialize(),n.Vy.info("lesson_player_progress_ready","Progress tracking initialized")}catch(e){n.Vy.warn("lesson_player_progress_failed","Progress tracking failed to initialize")}}setupEventListeners(){this.addControlListeners(),this.addVolumeListeners(),this.addKeyboardListeners(),this.addWindowListeners(),n.Vy.info("lesson_player_events_ready","Event listeners configured")}addControlListeners(){const e=this.controls.querySelector(".play-btn"),t=this.controls.querySelector(".pause-btn"),s=this.controls.querySelector(".restart-btn");e.addEventListener("click",()=>this.play()),t.addEventListener("click",()=>this.pause()),s.addEventListener("click",()=>this.restart()),this.eventListeners.set("play",e),this.eventListeners.set("pause",t),this.eventListeners.set("restart",s)}addVolumeListeners(){const e=this.controls.querySelector(".volume-btn"),t=this.controls.querySelector(".volume-slider");e.addEventListener("click",()=>this.toggleMute()),t.addEventListener("input",e=>this.setVolume(e.target.value)),this.eventListeners.set("volume",e),this.eventListeners.set("volumeSlider",t)}addKeyboardListeners(){document.addEventListener("keydown",e=>{if("INPUT"!==e.target.tagName)switch(e.code){case"Space":e.preventDefault(),this.isPlaying?this.pause():this.play();break;case"KeyR":e.ctrlKey&&(e.preventDefault(),this.restart());break;case"ArrowLeft":e.preventDefault(),this.seek(-10);break;case"ArrowRight":e.preventDefault(),this.seek(10)}})}addWindowListeners(){document.addEventListener("visibilitychange",()=>{document.hidden&&this.isPlaying&&this.pause()}),this.audioContext&&this.audioContext.addEventListener("statechange",()=>{"suspended"===this.audioContext.state&&this.pause()})}async loadLesson(e,t,s){try{n.Vy.info("lesson_player_load",`Loading lesson: day=${e}, age=${t}, tone=${s}`),this.updateStatus("loading","Synthesizing your lesson..."),this.currentParams={day:e,age:t,tone:s};const i=performance.now();this.currentLesson=await this.engine.synthesizeLesson(e,t,s);const a=performance.now()-i;if(!this.currentLesson||!this.currentLesson.title)throw new Error("Synthesis failed to produce valid lesson");this.displayLesson(),this.enableControls(),this.updateStatus("ready",`Lesson ready (${a.toFixed(0)}ms)`),this.progressTracker&&this.progressTracker.recordLessonLoad(e,t,s,a),n.Vy.info("lesson_player_loaded",`Lesson loaded successfully in ${a.toFixed(2)}ms`)}catch(n){i.zc.handle(n,{context:"lesson_player",phase:"load_lesson",params:{day:e,age:t,tone:s}}),this.updateStatus("error","Failed to load lesson"),this.displayError(n)}}displayLesson(){if(!this.currentLesson)return;const{title:e,content:t,metadata:s}=this.currentLesson;this.lessonContent.innerHTML=`\n            <h1 class="lesson-title">${this.escapeHtml(e)}</h1>\n            <div class="lesson-meta">\n                <span class="meta-item">\n                    <svg class="icon" viewBox="0 0 24 24" width="16" height="16">\n                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n                    </svg>\n                    Day ${s.day}\n                </span>\n                <span class="meta-item">\n                    <svg class="icon" viewBox="0 0 24 24" width="16" height="16">\n                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>\n                    </svg>\n                    Age ${s.age}\n                </span>\n                <span class="meta-item">\n                    <svg class="icon" viewBox="0 0 24 24" width="16" height="16">\n                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>\n                    </svg>\n                    ${s.tone}\n                </span>\n            </div>\n            <div class="lesson-text">${this.formatContent(t)}</div>\n        `}displayError(e){this.lessonContent.innerHTML='\n            <div class="lesson-error">\n                <h2>Unable to Load Lesson</h2>\n                <p>We encountered an issue while preparing your lesson. Please try again.</p>\n                <button class="retry-btn" onclick="window.Application.lessonPlayer.retryLoad()">\n                    Try Again\n                </button>\n            </div>\n        '}formatContent(e){return"string"==typeof e?e.split("\n\n").map(e=>`<p>${this.escapeHtml(e)}</p>`).join(""):this.escapeHtml(String(e))}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async play(){if(this.currentLesson)try{this.isPlaying=!0,this.updatePlayButton(),this.updateStatus("playing","Playing lesson..."),this.audioContext&&"running"===this.audioContext.state&&await this.startAudioSynthesis(),this.startProgressTracking(),n.Vy.info("lesson_player_play","Lesson playback started")}catch(e){i.zc.handle(e,{context:"lesson_player",phase:"play"}),this.pause()}}pause(){this.isPlaying=!1,this.updatePlayButton(),this.updateStatus("paused","Lesson paused"),this.stopProgressTracking(),n.Vy.info("lesson_player_pause","Lesson playback paused")}restart(){this.pause(),this.resetProgress(),this.play(),n.Vy.info("lesson_player_restart","Lesson restarted")}async startAudioSynthesis(){n.Vy.info("lesson_player_audio_start","Audio synthesis started")}updatePlayButton(){const e=this.controls.querySelector(".play-btn"),t=this.controls.querySelector(".pause-btn");this.isPlaying?(e.style.display="none",t.style.display="flex"):(e.style.display="flex",t.style.display="none")}updateStatus(e,t){const s=this.statusIndicator.querySelector(".status-icon"),n=this.statusIndicator.querySelector(".status-text"),i={ready:a.$.get("ui.theme.success"),loading:a.$.get("ui.theme.warning"),playing:a.$.get("ui.theme.primary"),paused:a.$.get("ui.theme.secondary"),error:a.$.get("ui.theme.error")};s.style.background=i[e]||i.ready,n.textContent=t}enableControls(){this.controls.querySelectorAll(".control-btn").forEach(e=>e.disabled=!1)}startProgressTracking(){this.progressInterval=setInterval(()=>{this.updateProgress()},1e3)}stopProgressTracking(){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)}updateProgress(){const e=this.progressBar.querySelector(".progress-fill"),t=this.progressBar.querySelector(".current-time");let s=parseFloat(e.style.width)||0;s=Math.min(s+1,100),e.style.width=`${s}%`,this.progressBar.setAttribute("aria-valuenow",s);const n=Math.floor(s/100*300);t.textContent=this.formatTime(n)}resetProgress(){const e=this.progressBar.querySelector(".progress-fill"),t=this.progressBar.querySelector(".current-time");e.style.width="0%",this.progressBar.setAttribute("aria-valuenow",0),t.textContent="0:00"}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}toggleMute(){const e=this.controls.querySelector(".volume-slider");this.controls.querySelector(".volume-btn");e.value>0?(this.previousVolume=e.value,e.value=0,this.setVolume(0)):(e.value=this.previousVolume||100,this.setVolume(this.previousVolume||100))}setVolume(e){this.audioElement&&(this.audioElement.volume=e/100);const t=this.controls.querySelector(".volume-btn").querySelector("svg");t.innerHTML=0==e?'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>':e<50?'<path d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/>':'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>'}seek(e){n.Vy.info("lesson_player_seek",`Seeking ${e} seconds`)}retryLoad(){this.currentParams&&this.loadLesson(this.currentParams.day,this.currentParams.age,this.currentParams.tone)}getStatus(){return{isReady:this.isReady,isPlaying:this.isPlaying,currentLesson:this.currentLesson?{day:this.currentLesson.metadata.day,age:this.currentLesson.metadata.age,tone:this.currentLesson.metadata.tone,title:this.currentLesson.title}:null,audioContext:this.audioContext?this.audioContext.state:null,progressTracker:this.progressTracker?this.progressTracker.getStatus():null}}async shutdown(){n.Vy.info("lesson_player_shutdown","Shutting down lesson player"),this.pause(),this.stopProgressTracking(),this.eventListeners.forEach((e,t)=>{if(e&&e.removeEventListener)switch(t){case"play":e.removeEventListener("click",()=>this.play());break;case"pause":e.removeEventListener("click",()=>this.pause());break;case"restart":e.removeEventListener("click",()=>this.restart())}}),this.audioContext&&await this.audioContext.close(),this.progressTracker&&await this.progressTracker.shutdown(),this.isReady=!1,n.Vy.info("lesson_player_shutdown_complete","Lesson player shutdown complete")}}}}]);