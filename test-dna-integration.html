<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #333333;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .test-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056CC;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>DNA Integration Test</h1>
        <p>Testing the DNA-driven lesson player system integration.</p>

        <div class="test-section">
            <h2>1. DNA File Loader Test</h2>
            <button class="test-button" onclick="testDNALoader()">Test DNA File Loader</button>
            <div id="dna-loader-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>2. Variant Generator Test</h2>
            <button class="test-button" onclick="testVariantGenerator()">Test Variant Generator</button>
            <div id="variant-generator-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>3. Content Generation Test</h2>
            <button class="test-button" onclick="testContentGeneration()">Test Content Generation</button>
            <div id="content-generation-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>4. Preference Switching Test</h2>
            <button class="test-button" onclick="testPreferenceSwitching()">Test Preference Switching</button>
            <div id="preference-switching-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>5. Face-Safe Positioning Test</h2>
            <button class="test-button" onclick="testFaceSafePositioning()">Test Face-Safe Positioning</button>
            <div id="face-safe-result" class="result"></div>
        </div>
    </div>

    <!-- Load DNA system components -->
    <script src="dna-file-loader.js"></script>
    <script src="variant-switcher.js"></script>
    <script src="face-safe-positioning.js"></script>
    <script src="complete-curriculum.js"></script>
    <script src="corrected-variant-generator-v2.js"></script>

    <script>
        let variantGenerator = null;
        let faceSafePositioning = null;

        // Initialize components when page loads
        document.addEventListener('DOMContentLoaded', function() {
            variantGenerator = new CorrectedVariantGeneratorV2();
            faceSafePositioning = new FaceSafePositioning();
            console.log('DNA Integration Test initialized');
        });

        async function testDNALoader() {
            const resultDiv = document.getElementById('dna-loader-result');
            resultDiv.innerHTML = 'Testing DNA File Loader...\n';
            
            try {
                const dnaLoader = new DNAFileLoader();
                const dnaData = await dnaLoader.loadDNAForDay(1);
                
                resultDiv.innerHTML += '✅ DNA File Loader Test PASSED\n';
                resultDiv.innerHTML += `Loaded DNA for day 1: ${dnaData.lesson_id}\n`;
                resultDiv.innerHTML += `Universal concept: ${dnaData.universal_concept}\n`;
                resultDiv.innerHTML += `Age expressions: ${Object.keys(dnaData.age_expressions).length} age groups\n`;
                resultDiv.innerHTML += `Tone delivery: ${Object.keys(dnaData.tone_delivery_dna).length} tones\n`;
                resultDiv.innerHTML += `Languages: ${Object.keys(dnaData.language_translations).length} languages\n`;
                
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML += `❌ DNA File Loader Test FAILED\n`;
                resultDiv.innerHTML += `Error: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
        }

        async function testVariantGenerator() {
            const resultDiv = document.getElementById('variant-generator-result');
            resultDiv.innerHTML = 'Testing Variant Generator...\n';
            
            try {
                if (!variantGenerator) {
                    throw new Error('Variant generator not initialized');
                }

                const content = await variantGenerator.generatePersonalizedContent();
                
                resultDiv.innerHTML += '✅ Variant Generator Test PASSED\n';
                resultDiv.innerHTML += `Generated opening: ${content.opening}\n`;
                resultDiv.innerHTML += `Questions count: ${content.questions.length}\n`;
                resultDiv.innerHTML += `Fortune: ${content.fortune}\n`;
                resultDiv.innerHTML += `Avatar mood: ${content.avatarMood.expression}\n`;
                
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML += `❌ Variant Generator Test FAILED\n`;
                resultDiv.innerHTML += `Error: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
        }

        async function testContentGeneration() {
            const resultDiv = document.getElementById('content-generation-result');
            resultDiv.innerHTML = 'Testing Content Generation...\n';
            
            try {
                if (!variantGenerator) {
                    throw new Error('Variant generator not initialized');
                }

                // Test different preferences
                const preferences = {
                    age: 'age_25',
                    tone: 'fun',
                    language: 'english',
                    avatar: 'kelly'
                };

                const content = await variantGenerator.generatePersonalizedContent(preferences);
                
                resultDiv.innerHTML += '✅ Content Generation Test PASSED\n';
                resultDiv.innerHTML += `Preferences: ${JSON.stringify(preferences)}\n`;
                resultDiv.innerHTML += `Opening: ${content.opening}\n`;
                resultDiv.innerHTML += `Questions: ${content.questions.length}\n`;
                resultDiv.innerHTML += `Metadata: ${JSON.stringify(content.metadata)}\n`;
                
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML += `❌ Content Generation Test FAILED\n`;
                resultDiv.innerHTML += `Error: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
        }

        async function testPreferenceSwitching() {
            const resultDiv = document.getElementById('preference-switching-result');
            resultDiv.innerHTML = 'Testing Preference Switching...\n';
            
            try {
                if (!variantGenerator) {
                    throw new Error('Variant generator not initialized');
                }

                // Test age switching
                const ageContent = await variantGenerator.switchAge('age_8');
                resultDiv.innerHTML += '✅ Age switching: PASSED\n';
                
                // Test tone switching
                const toneContent = await variantGenerator.switchTone('grandmother');
                resultDiv.innerHTML += '✅ Tone switching: PASSED\n';
                
                // Test language switching
                const languageContent = await variantGenerator.switchLanguage('spanish');
                resultDiv.innerHTML += '✅ Language switching: PASSED\n';
                
                // Test avatar switching
                const avatarContent = await variantGenerator.switchAvatar('ken');
                resultDiv.innerHTML += '✅ Avatar switching: PASSED\n';
                
                resultDiv.innerHTML += `Current preferences: ${JSON.stringify(variantGenerator.getCurrentPreferences())}\n`;
                
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML += `❌ Preference Switching Test FAILED\n`;
                resultDiv.innerHTML += `Error: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
        }

        function testFaceSafePositioning() {
            const resultDiv = document.getElementById('face-safe-result');
            resultDiv.innerHTML = 'Testing Face-Safe Positioning...\n';
            
            try {
                if (!faceSafePositioning) {
                    throw new Error('Face-safe positioning not initialized');
                }

                const screenSize = { width: 1920, height: 1080 };
                const safeZones = faceSafePositioning.calculateSafeZones('kelly_happy', screenSize);
                
                resultDiv.innerHTML += '✅ Face-Safe Positioning Test PASSED\n';
                resultDiv.innerHTML += `Screen size: ${screenSize.width}x${screenSize.height}\n`;
                resultDiv.innerHTML += `Face zone: ${JSON.stringify(safeZones.faceZone)}\n`;
                resultDiv.innerHTML += `Safe zones: ${Object.keys(safeZones.safeZones).length} available\n`;
                resultDiv.innerHTML += `Recommended positions: ${Object.keys(safeZones.recommendedPositions).length} positions\n`;
                
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML += `❌ Face-Safe Positioning Test FAILED\n`;
                resultDiv.innerHTML += `Error: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
        }
    </script>
</body>
</html> 