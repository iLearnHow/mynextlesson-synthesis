<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA-Ken Integration Test - Complete System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #007AFF;
            margin-bottom: 16px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 16px;
        }

        .control-group h3 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .control-group button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }

        .control-group button:hover {
            background: #0056CC;
        }

        .status-display {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin: 4px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
        }

        .content-display {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .content-display h3 {
            margin-bottom: 12px;
            color: #333;
        }

        .content-display p {
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .lesson-phase-controls {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .lesson-phase-controls button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .lesson-phase-controls button:hover {
            background: #218838;
        }

        .feedback-controls {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .feedback-controls button {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .feedback-controls button:hover {
            background: #e0a800;
        }

        .feedback-controls button.correct {
            background: #28a745;
            color: white;
        }

        .feedback-controls button.incorrect {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>DNA-Ken Integration Test - Complete System</h1>
        
        <div class="test-section">
            <h2>System Status</h2>
            <div id="system-status">
                <span class="status loading">Initializing systems...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>Lesson Controls</h2>
            <div class="control-panel">
                <div class="control-group">
                    <h3>Lesson Day</h3>
                    <input type="number" id="lesson-day" value="1" min="1" max="366">
                    <button onclick="loadLesson()">Load Lesson</button>
                </div>
                
                <div class="control-group">
                    <h3>Age</h3>
                    <select id="age-select">
                        <option value="age_6">6 years</option>
                        <option value="age_8">8 years</option>
                        <option value="age_12">12 years</option>
                        <option value="age_16">16 years</option>
                        <option value="age_25" selected>25 years</option>
                        <option value="age_40">40 years</option>
                        <option value="age_60">60 years</option>
                        <option value="age_80">80 years</option>
                    </select>
                    <button onclick="switchAge()">Switch Age</button>
                </div>
                
                <div class="control-group">
                    <h3>Tone</h3>
                    <select id="tone-select">
                        <option value="neutral" selected>Neutral</option>
                        <option value="fun">Fun</option>
                        <option value="grandmother">Grandmother</option>
                    </select>
                    <button onclick="switchTone()">Switch Tone</button>
                </div>
                
                <div class="control-group">
                    <h3>Language</h3>
                    <select id="language-select">
                        <option value="english" selected>English</option>
                        <option value="spanish">Spanish</option>
                        <option value="french">French</option>
                        <option value="german">German</option>
                        <option value="mandarin">Mandarin</option>
                    </select>
                    <button onclick="switchLanguage()">Switch Language</button>
                </div>
                
                <div class="control-group">
                    <h3>Avatar</h3>
                    <select id="avatar-select">
                        <option value="ken" selected>Ken</option>
                        <option value="kelly">Kelly</option>
                    </select>
                    <button onclick="switchAvatar()">Switch Avatar</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Lesson Content</h2>
            <div class="content-display" id="lesson-content">
                <h3>Current Lesson</h3>
                <p id="lesson-opening">Loading lesson content...</p>
                <p id="lesson-question">Loading question...</p>
                <p id="lesson-fortune">Loading fortune...</p>
            </div>
            
            <div class="lesson-phase-controls">
                <button onclick="advancePhase()">Advance Phase</button>
                <button onclick="resetPhase()">Reset to Opening</button>
            </div>
            
            <div class="feedback-controls">
                <button class="correct" onclick="handleFeedback(true)">Correct Answer</button>
                <button class="incorrect" onclick="handleFeedback(false)">Incorrect Answer</button>
            </div>
        </div>

        <div class="test-section">
            <h2>Current State</h2>
            <div class="status-display" id="current-state">
                <p><strong>Lesson Day:</strong> <span id="current-day">1</span></p>
                <p><strong>Age:</strong> <span id="current-age">age_25</span></p>
                <p><strong>Tone:</strong> <span id="current-tone">neutral</span></p>
                <p><strong>Language:</strong> <span id="current-language">english</span></p>
                <p><strong>Avatar:</strong> <span id="current-avatar">ken</span></p>
                <p><strong>Phase:</strong> <span id="current-phase">opening</span></p>
                <p><strong>Ken Expression:</strong> <span id="current-expression">ken_neutral_default</span></p>
            </div>
        </div>

        <div class="test-section">
            <h2>Integration Log</h2>
            <div class="content-display" id="integration-log">
                <p>System logs will appear here...</p>
            </div>
        </div>
    </div>

    <!-- Import all required systems -->
    <script src="dna-file-loader.js"></script>
    <script src="variant-switcher.js"></script>
    <script src="ken-wallpaper-system.js"></script>
    <script src="dna-ken-integration.js"></script>
    <script>
        // Test functions
        function updateSystemStatus(message, type = 'loading') {
            const statusElement = document.getElementById('system-status');
            statusElement.innerHTML = `<span class="status ${type}">${message}</span>`;
        }

        function updateCurrentState() {
            if (window.dnaKenIntegration) {
                const state = window.dnaKenIntegration.getCurrentState();
                
                document.getElementById('current-day').textContent = state.lesson?.day || '1';
                document.getElementById('current-age').textContent = state.preferences.age;
                document.getElementById('current-tone').textContent = state.preferences.tone;
                document.getElementById('current-language').textContent = state.preferences.language;
                document.getElementById('current-avatar').textContent = state.preferences.avatar;
                document.getElementById('current-phase').textContent = state.phase;
                document.getElementById('current-expression').textContent = state.kenState?.expression || 'unknown';
            }
        }

        function updateLessonContent(content) {
            if (content) {
                document.getElementById('lesson-opening').textContent = content.opening || 'No opening content';
                document.getElementById('lesson-question').textContent = content.questions?.[0]?.text || 'No question content';
                document.getElementById('lesson-fortune').textContent = content.fortune || 'No fortune content';
            }
        }

        function addLogMessage(message) {
            const logElement = document.getElementById('integration-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<p>[${timestamp}] ${message}</p>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Control functions
        async function loadLesson() {
            const day = parseInt(document.getElementById('lesson-day').value);
            addLogMessage(`Loading lesson for day ${day}...`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.loadLessonForDay(day);
                updateCurrentState();
                addLogMessage(`Lesson ${day} loaded successfully`);
            }
        }

        async function switchAge() {
            const age = document.getElementById('age-select').value;
            addLogMessage(`Switching to age: ${age}`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.switchPreferences({ age });
                updateCurrentState();
                addLogMessage(`Age switched to ${age}`);
            }
        }

        async function switchTone() {
            const tone = document.getElementById('tone-select').value;
            addLogMessage(`Switching to tone: ${tone}`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.switchPreferences({ tone });
                updateCurrentState();
                addLogMessage(`Tone switched to ${tone}`);
            }
        }

        async function switchLanguage() {
            const language = document.getElementById('language-select').value;
            addLogMessage(`Switching to language: ${language}`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.switchPreferences({ language });
                updateCurrentState();
                addLogMessage(`Language switched to ${language}`);
            }
        }

        async function switchAvatar() {
            const avatar = document.getElementById('avatar-select').value;
            addLogMessage(`Switching to avatar: ${avatar}`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.switchPreferences({ avatar });
                updateCurrentState();
                addLogMessage(`Avatar switched to ${avatar}`);
            }
        }

        async function advancePhase() {
            addLogMessage('Advancing lesson phase...');
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.advanceLessonPhase();
                updateCurrentState();
                addLogMessage(`Advanced to phase: ${window.dnaKenIntegration.lessonPhase}`);
            }
        }

        function resetPhase() {
            addLogMessage('Resetting to opening phase...');
            
            if (window.dnaKenIntegration) {
                window.dnaKenIntegration.lessonPhase = 'opening';
                updateCurrentState();
                addLogMessage('Reset to opening phase');
            }
        }

        async function handleFeedback(isCorrect) {
            const feedback = isCorrect ? 'correct' : 'incorrect';
            addLogMessage(`Handling ${feedback} feedback...`);
            
            if (window.dnaKenIntegration) {
                await window.dnaKenIntegration.handleUserFeedback(isCorrect);
                updateCurrentState();
                addLogMessage(`${feedback} feedback processed`);
            }
        }

        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (window.dnaKenIntegration) {
                    updateSystemStatus('✅ All systems initialized successfully', 'success');
                    updateCurrentState();
                    addLogMessage('DNA-Ken integration test ready');
                } else {
                    updateSystemStatus('❌ DNA-Ken integration failed to initialize', 'error');
                    addLogMessage('ERROR: DNA-Ken integration not found');
                }
            }, 2000);
        });
    </script>
</body>
</html> 